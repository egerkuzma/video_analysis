# Видео-анализатор эмоций в реальном времени

Скрипт для анализа эмоций в реальном времени с IP-камеры через WebSocket соединение. 
Использует FFmpeg для декодирования видеопотока и DeepFace для распознавания эмоций.

## Возможности

- Подключение к IP-камере через WebSocket
- Декодирование видеопотока с помощью FFmpeg
- Анализ эмоций в реальном времени
- Визуализация результатов с наложением текста
- Поддержка русского языка в интерфейсе

## Требования
в wsl
python3 -m venv env
source ~/tensorflow_project/env/bin/activate
pip install --upgrade pip
pip install tensorflow[and-cuda]
pip install websocket-client
pip install opencv-python
pip install deepface
pip install numpy
pip install websocket-client
pip install opencv-python
pip install deepface
pip install numpy
sudo apt update
pip install tf-keras


Необходимые компоненты:
- Python 3.7+
- FFmpeg
- OpenCV
- DeepFace
- websocket-client
- numpy

## Установка

1. Установите FFmpeg:
   ```bash
   # Для Ubuntu/Debian
   sudo apt-get install ffmpeg

   # Для Windows
   # Скачайте FFmpeg с официального сайта и добавьте в PATH
   ```


## Использование

1. Запустите скрипт:
   ```bash
   python video_analysis.py
   ```

2. Управление:
   - Нажмите 'q' в окне с видео для выхода
   - Ctrl+C в консоли для завершения работы

## Настройка

Основные параметры, которые можно изменить:

python
Размеры кадра
FRAME_WIDTH = 1280
FRAME_HEIGHT = 720
Область анализа (ROI)
LEFT_ROI_X = 240
LEFT_ROI_Y = 130
LEFT_ROI_WIDTH = 250
LEFT_ROI_HEIGHT = 150


## Структура проекта

- `video_analysis.py` - основной скрипт
- `websocket_debug.log` - лог-файл для отладки
- `requirements.txt` - зависимости проекта

## Особенности работы

- Использует FFmpeg для эффективного декодирования видеопотока
- Анализирует только определенную область кадра для повышения производительности
- Поддерживает обработку фрагментированного MP4 через WebSocket
- Многопоточная обработка для плавного воспроизведения

## Решение проблем

1. Если не отображается видео:
   - Проверьте URL камеры
   - Убедитесь, что FFmpeg установлен корректно

2. Если не работает распознавание эмоций:
   - Проверьте освещение
   - Настройте размер ROI

## Лицензия

MIT

# Система подсчета людей с использованием YOLOv8 и WebSocket

## Описание
Этот скрипт представляет собой систему видеоаналитики, которая подключается к IP-камере через WebSocket, обрабатывает видеопоток в реальном времени и подсчитывает количество уникальных людей, проходящих через заданную зону детекции.

## Основные возможности
- Подключение к IP-камере через WebSocket
- Обработка видеопотока с помощью FFmpeg
- Детекция и трекинг людей с использованием YOLOv8
- Подсчет уникальных посетителей в заданной зоне
- Визуализация результатов в реальном времени
- Автоматическое переподключение при потере соединения

## Требования
- Python 3.8+
- PyTorch
- OpenCV (cv2)
- Ultralytics YOLOv8
- websocket-client
- FFmpeg
- CUDA (опционально, для ускорения на GPU)

## Установка
==================================
https://pytorch.org/get-started/locally/#windows-prerequisites
pip install websocket-client
pip install opencv-python
pip install ultralytics
===================================


Также необходимо установить FFmpeg:
- Для Ubuntu/Debian: `sudo apt-get install ffmpeg`
- Для Windows: Скачайте FFmpeg с официального сайта и добавьте в PATH
- Для macOS: `brew install ffmpeg`

## Настройка
1. Скачайте модель YOLOv8:
   - По умолчанию используется `yolov8x.pt`
   - Можно использовать другие версии (n, s, m, l, x)

2. Настройте параметры зоны детекции в коде:

python
DETECTION_ZONE = {
'x': 350,
'y': 50,
'width': 150,
'height': 150
}


3. При необходимости измените параметры видео:

python
FRAME_WIDTH = 1280
FRAME_HEIGHT = 720
SCALE_FACTOR = 1


## Использование
1. Запустите скрипт:

bash
python test_video.py


2. Для выхода:
   - Нажмите 'q' в окне с видео
   - Или Ctrl+C в консоли

## Логирование
- Логи сохраняются в файл `websocket_debug.log`
- Также выводятся в консоль
- Уровень логирования можно настроить в коде

## Особенности работы
- Скрипт отслеживает только людей (class 0 в YOLO)
- Используется система охлаждения (cooldown) для предотвращения повторного подсчета
- Поддерживает автоматическое переподключение при потере соединения
- Визуализирует зону детекции и треки объектов
- Отображает общее количество уникальных посетителей

## Устранение неполадок
1. Если возникают проблемы с подключением:
   - Проверьте доступность камеры
   - Убедитесь в правильности URL
   - Проверьте сетевое подключение

2. При проблемах с производительностью:
   - Уменьшите разрешение видео
   - Используйте более легкую версию YOLO (например, yolov8n)
   - Убедитесь в наличии GPU и корректной установке CUDA

## Безопасность
- Скрипт игнорирует проверку SSL-сертификатов
- При использовании в продакшене рекомендуется включить проверку сертификатов
- Храните токены доступа в безопасном месте

## Лицензия
MIT
